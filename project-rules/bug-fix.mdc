---
type: "workflow_rule"
description: "Fluxo de trabalho completo de corre√ß√£o de bugs, do problema ao PR"
globs: ["**/*"]
priority: 600
alwaysApply: false

# Gerenciamento de Vers√£o
version: "2.6.0"
last_updated: "2025-10-19"
author: "system"
status: "stable"
compatibility: "rule-system >= 2.0"

changelog:
  - version: "2.6.0"
    date: "2025-10-19"
    changes:
      - "Adicionado sistema de gerenciamento de vers√£o"
      - "Padronizada estrutura do arquivo de regra"
---

# üêõ Bug Fix Workflow - Fluxo de Corre√ß√£o de Bugs

Fluxo de trabalho completo de corre√ß√£o de bugs, desde a cria√ß√£o do problema at√© o pull request.

## üöÄ Commands - Comandos

- `/bug-fix` - Inicia o fluxo de corre√ß√£o de bugs
- `/reproduce-bug` - Reproduz o bug
- `/root-cause` - An√°lise de causa raiz
- `/fix-verify` - Verifica√ß√£o da corre√ß√£o

## üìã Process - Fluxo de Corre√ß√£o

### üîç Before Starting - Prepara√ß√£o Inicial

#### 1. GitHub Issue Creation - Cria√ß√£o de Problema no GitHub
```markdown
**T√≠tulo do Bug**: [Componente/M√≥dulo] T√≠tulo descritivo curto

**Informa√ß√µes do Ambiente**:
- Sistema Operacional: Windows 11 / macOS 13 / Ubuntu 22.04
- Navegador: Chrome 120 / Firefox 121 / Safari 17
- Vers√£o do Aplicativo: v2.1.0
- Vers√£o do Node.js: v18.19.0

**Passos para Reproduzir**:
1. Abrir o aplicativo
2. Clicar no bot√£o de login
3. Inserir credenciais v√°lidas
4. Clicar em enviar

**Comportamento Esperado**: O usu√°rio deve logar com sucesso e ser redirecionado para o painel

**Comportamento Real**: Exibe "erro de rede", o usu√°rio permanece na p√°gina de login

**Mensagem de Erro**:
```
TypeError: Cannot read property 'token' of undefined
  at LoginComponent.handleLogin (login.component.ts:45)
```

**Captura de Tela/V√≠deo**: [Anexar capturas de tela ou v√≠deos relevantes]

**Prioridade**: Alta (High) / M√©dia (Medium) / Baixa (Low)
**Etiquetas**: bug, frontend, autentica√ß√£o
```

#### 2. Git Branch Creation - Cria√ß√£o de Ramifica√ß√£o (Branch) Git
```bash
# Criar e mudar para a ramifica√ß√£o da funcionalidade
git checkout -b fix/login-token-error

# Ou usar um nome de ramifica√ß√£o mais descritivo
git checkout -b fix/issue-123-login-authentication-error
```

### üîß Fix the Bug - Corrigindo o Bug

#### Passo 1: Reproduce the Issue - Reproduzir o Problema
```bash
# 1. Mudar para a ramifica√ß√£o do problema
git checkout main
git pull origin main

# 2. Tentar reproduzir o bug
npm start
# Siga os passos descritos no problema

# 3. Confirmar que o problema existe
# Registrar passos de reprodu√ß√£o e mensagens de erro
```

#### Passo 2: Write Failing Test - Escrever Teste Falho
```javascript
// Exemplo: Escrevendo um caso de teste para o bug
describe('LoginComponent', () => {
  it('should handle login with valid credentials', async () => {
    // Este teste deve falhar porque o bug existe
    const mockUser = { username: 'test', password: 'password' };
    const result = await loginComponent.handleLogin(mockUser);
    
    expect(result.success).toBe(true);
    expect(result.token).toBeDefined();
    expect(result.user).toEqual(expect.objectContaining({
      username: 'test'
    }));
  });

  it('should handle undefined response gracefully', async () => {
    // Testar condi√ß√µes de contorno (boundary conditions)
    mockApiService.login.mockResolvedValue(undefined);
    
    const result = await loginComponent.handleLogin(mockUser);
    expect(result.success).toBe(false);
    expect(result.error).toBeDefined();
  });
});
```

#### Passo 3: Implement the Fix - Implementar a Corre√ß√£o
```typescript
// C√≥digo antes da corre√ß√£o
async handleLogin(credentials: LoginCredentials) {
  try {
    const response = await this.authService.login(credentials);
    // Bug: N√£o verifica se a resposta existe
    localStorage.setItem('token', response.token);
    this.router.navigate(['/dashboard']);
  } catch (error) {
    this.showError('Falha no login');
  }
}

// C√≥digo ap√≥s a corre√ß√£o
async handleLogin(credentials: LoginCredentials) {
  try {
    const response = await this.authService.login(credentials);
    
    // Corre√ß√£o: Adicionar valida√ß√£o de resposta
    if (!response || !response.token) {
      throw new Error('Resposta inv√°lida do servidor');
    }
    
    localStorage.setItem('token', response.token);
    this.router.navigate(['/dashboard']);
    return { success: true, token: response.token, user: response.user };
  } catch (error) {
    console.error('Erro de login:', error);
    this.showError('Falha no login: ' + error.message);
    return { success: false, error: error.message };
  }
}
```

#### Passo 4: Verify Test Passes - Verificar Aprova√ß√£o dos Testes
```bash
# Executar teste espec√≠fico
npm test -- --grep "LoginComponent"

# Executar todos os testes
npm test

# Garantir que os testes passaram
‚úì should handle login with valid credentials
‚úì should handle undefined response gracefully
```

#### Passo 5: Run Full Test Suite - Executar Su√≠te de Testes Completa
```bash
# Executar todos os testes para garantir que n√£o haja regress√£o
npm run test:all

# Executar testes de ponta a ponta (e2e)
npm run test:e2e

# Executar lint (verifica√ß√£o de c√≥digo)
npm run lint

# Executar verifica√ß√£o de tipos
npm run type-check
```

### ‚úÖ On Completion - Opera√ß√µes Ap√≥s Conclus√£o

#### 1. Git Commit - Commit Git
```bash
# Adicionar mudan√ßas
git add .

# Commit das mudan√ßas, referenciando o n√∫mero do problema
git commit -m "üêõ fix(auth): corrigir erro de token indefinido no login (#123)

- Adicionada valida√ß√£o de resposta para evitar erro de undefined
- Melhorado tratamento de erro e feedback ao usu√°rio
- Adicionado caso de teste para condi√ß√µes de contorno

Corrige o problema de travamento quando o servidor retorna uma resposta vazia.
Agora exibe uma mensagem de erro significativa para o usu√°rio.

Fixes #123"
```

#### 2. Push Branch - Enviar Ramifica√ß√£o (Push)
```bash
# Enviar ramifica√ß√£o para o reposit√≥rio remoto
git push origin fix/login-token-error
```

#### 3. Create Pull Request - Criar Pull Request (PR)
```markdown
## üêõ Bug Fix: Corrigir erro de token indefinido no login

### Descri√ß√£o do Problema
Corrige #123 - Erro "Cannot read property 'token' of undefined" ao fazer login.

### Causa Raiz
Quando o servi√ßo de autentica√ß√£o retornava uma resposta vazia ou malformada, o c√≥digo tentava acessar a propriedade `token` sem a valida√ß√£o adequada.

### Solu√ß√£o
- ‚úÖ Adicionada l√≥gica de valida√ß√£o de resposta
- ‚úÖ Melhorado o mecanismo de tratamento de erros
- ‚úÖ Adicionado feedback significativo ao usu√°rio
- ‚úÖ Adicionados testes de condi√ß√µes de contorno

### Testes
- [x] Testes unit√°rios aprovados
- [x] Testes de integra√ß√£o aprovados
- [x] Verifica√ß√£o manual realizada
- [x] Testes de regress√£o aprovados

### Escopo de Impacto
- Afeta apenas o componente de login
- Compatibilidade reversa mantida
- Sem altera√ß√µes disruptivas (breaking changes)

### Capturas de Tela/V√≠deo
[Adicionar capturas de tela ou v√≠deos ap√≥s a corre√ß√£o]

### Lista de Verifica√ß√£o (Checklist)
- [x] Revis√£o de c√≥digo conclu√≠da
- [x] Cobertura de testes suficiente
- [x] Documenta√ß√£o atualizada
- [x] Sem riscos de seguran√ßa
```

## üîç Root Cause Analysis - An√°lise de Causa Raiz

### T√©cnica dos Cinco Porqu√™s (Five Whys)
```
1. Por que o login falhou?
   ‚Üí Porque o c√≥digo tentou acessar a propriedade token de um objeto undefined.

2. Por que o response era undefined?
   ‚Üí Porque o servi√ßo de API retornou uma resposta vazia em certas situa√ß√µes.

3. Por que o servi√ßo de API retornou uma resposta vazia?
   ‚Üí Porque n√£o houve tratamento correto para erros de servidor ou tempo de rede esgotado (timeout).

4. Por que a resposta n√£o foi validada?
   ‚Üí Porque assumiu-se durante o desenvolvimento que a API sempre retornaria uma resposta v√°lida.

5. Por que n√£o foram consideradas situa√ß√µes de erro?
   ‚Üí Porque faltavam diretrizes de melhores pr√°ticas para tratamento de erros.
```

### Medidas Preventivas (Prevention Measures)
- Adicionar padr√µes de valida√ß√£o de resposta
- Implementar padr√µes de tratamento de erro
- Aumentar testes de condi√ß√µes de contorno
- Atualizar a lista de verifica√ß√£o (checklist) de revis√£o de c√≥digo

## üìä Bug Categories - Categorias de Bugs

### N√≠veis de Gravidade (Severity Levels)
- **Cr√≠tico (Critical)** - Travamento do sistema, perda de dados
- **Alto (High)** - Funcionalidade principal inutiliz√°vel
- **M√©dio (Medium)** - Funcionalidade limitada, com alternativa dispon√≠vel (workaround)
- **Baixo (Low)** - Problemas de interface, n√£o afeta a funcionalidade

### Tipos de Bug (Bug Types)
- **Erro L√≥gico (Logic Error)** - Erro na l√≥gica de programa√ß√£o
- **Erro em Tempo de Execu√ß√£o (Runtime Error)** - Erro durante a execu√ß√£o
- **Problema de UI/UX (UI/UX Issue)** - Problemas de interface/experi√™ncia
- **Performance** - Problemas de desempenho
- **Seguran√ßa (Security)** - Vulnerabilidades de seguran√ßa
- **Compatibilidade (Compatibility)** - Problemas de compatibilidade

## üõ†Ô∏è Tools and Techniques - Ferramentas e T√©cnicas

### Ferramentas de Depura√ß√£o (Debugging Tools)
```bash
# Ferramentas de desenvolvedor do navegador
F12 ‚Üí Console/Network/Sources

# Depura√ß√£o do Node.js
node --inspect-brk app.js

# Configura√ß√£o de depura√ß√£o no VS Code
{
  "type": "node",
  "request": "launch",
  "name": "Debug App",
  "program": "${workspaceFolder}/src/index.js"
}
```

### Registro e Monitoramento (Logging and Monitoring)
```javascript
// Registro estruturado (Logging)
console.log('Tentativa de login', {
  timestamp: new Date().toISOString(),
  userId: credentials.username,
  userAgent: navigator.userAgent,
  error: error.message
});

// Integra√ß√£o com monitoramento de erros
import * as Sentry from '@sentry/browser';
Sentry.captureException(error);
```

## ‚úÖ Best Practices - Melhores Pr√°ticas

### Preven√ß√£o de Bugs (Bug Prevention)
- **Revis√£o de C√≥digo** - Revisar todas as altera√ß√µes de c√≥digo
- **Desenvolvimento Orientado a Testes (TDD)** - Escrever testes antes do c√≥digo
- **An√°lise Est√°tica** - Usar ferramentas como ESLint, TypeScript, etc.
- **Integra√ß√£o Cont√≠nua (CI)** - Automatizar testes e implanta√ß√£o

### Corre√ß√£o de Bugs (Bug Fixing)
- **Priorizar Reprodu√ß√£o** - Garantir que o bug possa ser reproduzido de forma est√°vel
- **Altera√ß√£o M√≠nima** - Alterar apenas o c√≥digo estritamente necess√°rio
- **Cobertura de Testes** - Adicionar casos de teste para o bug identificado
- **Atualiza√ß√£o de Documenta√ß√£o** - Atualizar documentos relacionados

### Comunica√ß√£o
- **Atualiza√ß√µes Tempestivas** - Atualizar regularmente o status do Issue
- **Descri√ß√£o Clara** - Descrever detalhadamente o problema e a solu√ß√£o
- **Compartilhamento de Conhecimento** - Compartilhar experi√™ncias e li√ß√µes aprendidas na corre√ß√£o
